#!/usr/bin/env bash

# $ cat $WD/.env
# export SLACK_USER_TOKEN=...
# export SLACK_BOT_TOKEN=...

set -e

export API="https://slack.com/api"

export BOT_ID
export URL

main() {
    cargo build --release
    BOT_ID=$(curl "$API/auth.test?token=$SLACK_BOT_TOKEN" | jq -r ".user_id")
    URL=$(curl "$API/rtm.connect?token=$SLACK_BOT_TOKEN" | jq -r ".url")
    cargo run --release
}

while true; do
    main || true
done
